<?xml version="1.0" encoding="UTF-8"?>
<!--
  DDDAC RVF Animal Sampling Form
  Designed by: Kihara Absolomon <a.kihara@cgiar.org>
  Purpose: For DDDAC RVF Animal Samples and Data Collection
  Project: DDDAC RVF

  Copyright 2013 ILRI

  This is a standalone XForm to be used with ODK.

  This is a free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This XForm is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this XForm.  If not, see http://www.gnu.org/licenses/
-->

<h:html xmlns="http://www.w3.org/2002/xforms" xmlns:h="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa">
	<h:head>
	<h:title>DDDAC: Animal Sampling</h:title>
	<model>
		<itext>
			<translation lang="eng">
				<!--  User prompts -->
				<text id="hhid"><value>Scan this household's QR code</value></text>
				<text id="hhid_a"><value>Enter this household's id</value></text>
				<text id="animal"><value>Enter the animal id</value></text>
				<text id="species"><value>What is the species of this animal.</value></text>
				<text id="breed"><value>What is the breed of this animal</value></text>
				<text id="sex"><value>What is the sex of this animal</value></text>
				<text id="body_score"><value>What is the body score of this animal.</value></text>
				<text id="blood"><value>Scan the drawn sample in EDTA tube.</value></text>
				<text id="blood_a"><value>Enter the barcode of the drawn sample in EDTA tube.</value></text>
				<text id="serum"><value>Scan the drawn sample in plain tube.</value></text>
				<text id="serum_a"><value>Enter the barcode of the drawn sample in plain tube.</value></text>
				<text id="add_samples"><value>Additional samples</value></text>
				<text id="other_samples"><value>Scan the additional sample.</value></text>
				<text id="other_samples_a"><value>Enter the barcode of any additional sample</value></text>

				<!--  Error Messages -->
				<text id="hhid_m"><value>Scan this household's QR code</value></text>
				<text id="hhid_a_m"><value>Enter this household's id</value></text>
				<text id="animal_m"><value>Enter the animal id</value></text>
				<text id="species_m"><value>What is the species of this animal.</value></text>
				<text id="breed_m"><value>What is the breed of this animal</value></text>
				<text id="sex_m"><value>What is the sex of this animal</value></text>
				<text id="body_score_m"><value>What is the body score of this animal.</value></text>
				<text id="blood_m"><value>Scan the drawn sample in EDTA tube.</value></text>
				<text id="blood_a_m"><value>Enter the barcode of the drawn sample in EDTA tube.</value></text>
				<text id="serum_m"><value>Scan the drawn sample in plain tube.</value></text>
				<text id="serum_a_m"><value>Enter the barcode of the drawn sample in plain tube.</value></text>
				<text id="other_samples_m"><value>Scan the additional sample.</value></text>
				<text id="other_samples_a_m"><value>Enter the barcode of any additional sample</value></text>
				<text id="comments"><value>Enter any comments for this animal</value></text>
				<text id="errMsg_blood"><value>Enter a valid blood sample. Expecting 'BDTxxxxxx'</value></text>
				<text id="errMsg_serum"><value>Enter a valid serum sample. Expecting 'BSRxxxxxx'</value></text>

				<!--  Options -->
				<text id="goat"><value>Goat</value></text>
				<text id="sheep"><value>Sheep</value></text>
				<text id="cattle"><value>Cattle</value></text>

				<!-- Cattle Breeds -->
				<text id="c_oboran"><value>Orma Boran</value></text>
				<text id="c_kboran"><value>Kenyan Boran</value></text>
				<text id="c_zebu"><value>East African Zebu</value></text>
				<text id="c_sahiwal"><value>Sahiwal</value></text>
				<text id="c_cross"><value>Cross</value></text>

				<!-- Goat Breeds -->
				<text id="g_ea"><value>Small East African Goat</value></text>
				<text id="g_galla"><value>Galla Goat</value></text>
				<text id="g_toggenburg"><value>Toggenburg</value></text>
				<text id="g_saanan"><value>Saanan</value></text>
				<text id="g_cross"><value>Cross</value></text>

				<!-- Sheep Breeds -->
				<text id="s_persian"><value>Black Head Persian</value></text>
				<text id="s_somali"><value>Somali Sheep</value></text>
				<text id="s_maasai"><value>Red Maasai</value></text>
				<text id="s_cross"><value>Cross</value></text>

				<text id="male"><value>Male</value></text>
				<text id="female"><value>Female</value></text>

			</translation>
		</itext>

		<instance>
			<samples id="samples_v1">
				<start_time /> 	<!-- auto field -->
				<DeviceID /> 		<!-- auto field -->
				<user_name /> 		<!-- auto field -->

				<animal_id />
				<species />
				<breed />
				<sex />
				<body_score />
				<blood />
				<blood_a />
				<serum />
				<serum_a />
				<other_samples>
					<others />
					<others_a />
				</other_samples>
				<comments /> 	<!-- auto field -->
				<end_time /> 	<!-- auto field -->
			</samples>
		</instance>

		<instance id="species">
			<options>
				<opt><value>goat</value></opt>
				<opt><value>sheep</value></opt>
				<opt><value>cattle</value></opt>
			</options>
		</instance>

		<instance id="breeds">
			<options>
			</options>
		</instance>

		<instance id="cattle">
			<options>
				<opt><value>c_oboran</value></opt>
				<opt><value>c_kboran</value></opt>
				<opt><value>c_zebu</value></opt>
				<opt><value>c_sahiwal</value></opt>
				<opt><value>c_cross</value></opt>
			</options>
		</instance>

		<instance id="goats">
			<options>
				<opt><value>g_ea</value></opt>
				<opt><value>g_galla</value></opt>
				<opt><value>g_toggenburg</value></opt>
				<opt><value>g_saanan</value></opt>
				<opt><value>g_cross</value></opt>
			</options>
		</instance>

		<instance id="sheep">
			<options>
				<opt><value>s_persian</value></opt>
				<opt><value>s_somali</value></opt>
				<opt><value>s_maasai</value></opt>
				<opt><value>s_cross</value></opt>
			</options>
		</instance>

		<instance id="sex">
			<options>
				<opt><value>male</value></opt>
				<opt><value>female</value></opt>
			</options>
		</instance>

      <bind nodeset="/samples/start_time" type="xsd:dateTime" jr:preload="timestamp" jr:preloadParams="start"/>
      <bind nodeset="/samples/DeviceID" type="xsd:string" jr:preload="property" jr:preloadParams="DeviceID" />
      <bind nodeset="/samples/user_name" type="xsd:string" jr:preload="property" jr:preloadParams="username"/>

		<bind nodeset="/samples/animal_id" type="string" required="false()"  />
		<bind nodeset="/samples/species" type="select1" required="true()"  />
		<bind nodeset="/samples/breed" type="select" required="true()"  />
		<bind nodeset="/samples/sex" type="select1" required="true()"  />
		<bind nodeset="/samples/body_score" type="int" required="true()"  />
		<bind nodeset="/samples/blood" type="barcode" required="false()" constraint="regex(., '^BDT[0-9]{6}$')" jr:constraintMsg="jr:itext('errMsg_blood')" />
		<bind nodeset="/samples/blood_a" relevant="/samples/blood = ''" type="string" required="true()"  constraint="regex(., '^BDT[0-9]{6}$')" jr:constraintMsg="jr:itext('errMsg_blood')" />
		<bind nodeset="/samples/serum" type="barcode" required="true()"  constraint="regex(., '^BSR[0-9]{6}$')" jr:constraintMsg="jr:itext('errMsg_serum')" />
		<bind nodeset="/samples/serum_a" relevant="/samples/serum = ''" type="string" required="true()"  constraint="regex(., '^BSR[0-9]{6}$')" jr:constraintMsg="jr:itext('errMsg_serum')" />
		<bind nodeset="/samples/other_samples/others" type="barcode" required="false()"  />
		<bind nodeset="/samples/other_samples/others_a" relevant="/samples/other_samples/others = ''" type="string" required="false()"  />
		<bind nodeset="/samples/comments"  type="string" required="false()"  />

      <bind nodeset="/samples/end_time" type="xsd:dateTime" jr:preload="timestamp" jr:preloadParams="end"/>
  </model>	
  </h:head>	
  <h:body>	
	<input ref="/samples/animal_id"><label ref="jr:itext('animal')" /></input>

	<select1 ref="/samples/species">
		<label ref="jr:itext('species')" />
		<itemset nodeset="instance('species')/options/opt">
			<label ref="jr:itext(value)" />
			<value ref="value" />
		</itemset>
	</select1>

	<select ref="/samples/breed">
		<label ref="jr:itext('breed')" />
		<itemset nodeset="instance(/samples/species)/options/opt">
			<label ref="jr:itext(value)" />
			<value ref="value" />
		</itemset>
	</select>

	<select1 ref="/samples/sex">
		<label ref="jr:itext('sex')" />
		<itemset nodeset="instance('sex')/options/opt">
			<label ref="jr:itext(value)" />
			<value ref="value" />
		</itemset>
	</select1>

	<input ref="/samples/body_score"><label ref="jr:itext('body_score')" /></input>
	<input ref="/samples/blood"><label ref="jr:itext('blood')" /></input>
	<input ref="/samples/blood_a"><label ref="jr:itext('blood_a')" /></input>
	<input ref="/samples/serum"><label ref="jr:itext('serum')" /></input>
	<input ref="/samples/serum_a"><label ref="jr:itext('serum_a')" /></input>
	<group>
		<label ref="jr:itext('add_samples')" />
		<repeat nodeset="/samples/other_samples">
			<input ref="/samples/other_samples/others"><label ref="jr:itext('other_samples')" /></input>
			<input ref="/samples/other_samples/others_a"><label ref="jr:itext('other_samples_a')" /></input>
		</repeat>
	</group>

	<input ref="/samples/comments"><label ref="jr:itext('comments')" /></input>

  </h:body>
</h:html>

